import{_ as S,d as U,u as $,y as V,f as E,m as T,p as j,q as O,t as x,r as m,o as k,g as b,c as r,w as p,v as q,i as N,b as e,n as i,e as z,j as C}from"./index-2PiHdJuC.js";import{u as A}from"./use-menu-rR8rP7ih.js";import{u as B}from"./use-axios-BjUjc9os.js";import{E as I,u as K}from"./use-erorrs-ZpWOnm9m.js";import{_ as L}from"./user-BOwL5khC.js";const R=U({components:{ErrorMessage:I},setup(){A().onSelectedKeys(["admin-users"]);const s=$(),g=V(),w=E([]),h=E([]),l=K(),f=T(()=>l.errors),o=j({name:"",email:"",password:"",password_confirmation:"",department_id:[],is_active:[],change_password:!1}),u=localStorage.getItem("accessToken"),d=B();u&&d.initializeAxios(u);const c=async()=>{try{const n=await d.axiosInstance.get(`/users/edit/${g.params.id}`);o.name=n.data.user.name,o.email=n.data.user.email,o.is_active=n.data.user.is_active,o.department_id=n.data.user.department_id,w.value=n.data.departments,h.value=[{value:1,label:"Kích hoạt"},{value:0,label:"Khóa"}]}catch(n){console.error("Lỗi khi lấy danh sách người dùng:",n)}},_=()=>{l.clearAllErrors(),o.email?/\S+@\S+\.\S+/.test(o.email)||l.setError("email","Email không hợp lệ!"):l.setError("email","Vui lòng nhập vào Email!"),o.change_password&&(o.password?o.password.length<8&&l.setError("password","Mật khẩu phải có ít nhất 8 ký tự!"):l.setError("password","Vui lòng nhập vào mật khẩu!"),o.password_confirmation?o.password!==o.password_confirmation&&l.setError("password_confirmation","Mật khẩu và xác nhận mật khẩu không khớp!"):l.setError("password_confirmation","Vui lòng nhập vào xác nhận mật khẩu!")),o.name?o.name.length<3&&l.setError("name","Tên tài khoản phải có ít nhất 3 ký tự!"):l.setError("name","Vui lòng nhập tên tài khoản!"),!(Object.keys(l.errors).length>0)&&d.axiosInstance.put(`/users/update/${g.params.id}`,o).then(n=>{n.status==200&&(N.success("Cập nhật thành công"),s.push({name:"admin-users"}))}).catch(n=>{const a=n.response.data.errors;Object.keys(a).forEach(y=>{const M=a[y][0];l.setError(y,M)})})},v=(n,a)=>a.label.toLowerCase().indexOf(n.toLowerCase())>=0;return O(()=>{c()}),{departments:w,...x(o),errors:f,status:h,filterOption:v,updateUser:_}}}),P={class:"row"},X={class:"col-12 col-sm-4"},H={class:"row"},D={class:"col-12 d-flex justify-content-center mb-3"},F={class:"col-12 d-flex justify-content-center"},G={class:"col-12 col-sm-8"},J={class:"row mb-3"},Q={class:"col-12 col-sm-3 text-start text-sm-end"},W={class:"col-12 col-sm-5"},Y={class:"row mb-3"},Z={class:"col-12 col-sm-3 text-start text-sm-end"},ss={class:"col-12 col-sm-5"},es={class:"row mb-3"},ts={class:"col-12 col-sm-3 text-start text-sm-end"},os={class:"col-12 col-sm-5"},as={class:"row mb-3"},rs={class:"col-12 col-sm-3 text-start text-sm-end"},ns={class:"col-12 col-sm-5"},ls={class:"row mb-3"},is={class:"col-12 col-sm-5"},ds={key:0,class:"row mb-3"},ms={class:"col-12 col-sm-3 text-start text-sm-end"},ps={class:"col-12 col-sm-5"},us={key:1,class:"row mb-3"},cs={class:"col-12 col-sm-3 text-start text-sm-end"},vs={class:"col-12 col-sm-5"},gs={class:"row"},ws={class:"col-12 d-grid d-sm-flex justify-content-sm-end mx-auto"};function hs(t,s,g,w,h,l){const f=m("a-avatar"),o=m("a-button"),u=m("a-input"),d=m("ErrorMessage"),c=m("a-select"),_=m("a-checkbox"),v=m("a-input-password"),n=m("a-card");return k(),b("form",{onSubmit:s[8]||(s[8]=q(a=>t.updateUser(),["prevent"]))},[r(n,{title:"Cập nhật tài khoản",style:{width:"100%"}},{default:p(()=>[e("div",P,[e("div",X,[e("div",H,[e("div",D,[r(f,{shape:"square",size:200},{icon:p(()=>s[9]||(s[9]=[e("img",{src:L,alt:"avatar"},null,-1)])),_:1})]),e("div",F,[r(o,{type:"primary"},{default:p(()=>s[10]||(s[10]=[e("i",{class:"fa-solid fa-plus me-2"},null,-1),e("span",null,"Chọn ảnh",-1)])),_:1})])])]),e("div",G,[e("div",J,[e("div",Q,[e("label",null,[s[11]||(s[11]=e("span",{class:"text-danger me-1"},"*",-1)),e("span",{class:i({"text-danger":t.errors.name})}," Tên tài khoản ",2)])]),e("div",W,[r(u,{required:"",placeholder:"Tên tài khoản","allow-clear":"",value:t.name,"onUpdate:value":s[0]||(s[0]=a=>t.name=a),class:i({"input-danger":t.errors.name})},null,8,["value","class"]),s[12]||(s[12]=e("div",{class:"w-100"},null,-1)),r(d,{message:t.errors.name},null,8,["message"])])]),e("div",Y,[e("div",Z,[e("label",null,[s[13]||(s[13]=e("span",{class:"text-danger me-1"},"*",-1)),e("span",{class:i({"text-danger":t.errors.email})}," Email ",2)])]),e("div",ss,[r(u,{placeholder:"Email","allow-clear":"",required:"",id:"email",value:t.email,"onUpdate:value":s[1]||(s[1]=a=>t.email=a),class:i({"input-danger":t.errors.email})},null,8,["value","class"]),s[14]||(s[14]=e("div",{class:"w-100"},null,-1)),r(d,{message:t.errors.email},null,8,["message"])])]),e("div",es,[e("div",ts,[e("label",null,[s[15]||(s[15]=e("span",{class:"text-danger me-1"},"*",-1)),e("span",{class:i({"text-danger":t.errors.department_id})}," Phòng ban",2)])]),e("div",os,[r(c,{"show-search":"",placeholder:"Phòng ban",style:{width:"100%"},options:t.departments,"filter-option":t.filterOption,"allow-clear":"",value:t.department_id,"onUpdate:value":s[2]||(s[2]=a=>t.department_id=a),class:i({"select-danger":t.errors.department_id})},null,8,["options","filter-option","value","class"]),s[16]||(s[16]=e("div",{class:"w-100"},null,-1)),r(d,{message:t.errors.department_id},null,8,["message"])])]),e("div",as,[e("div",rs,[e("label",null,[s[17]||(s[17]=e("span",{class:"text-danger me-1"},"*",-1)),e("span",{class:i({"text-danger":t.errors.is_active})}," Trạng thái",2)])]),e("div",ns,[r(c,{"show-search":"",placeholder:"Trạng thái",style:{width:"100%"},options:t.status,"filter-option":t.filterOption,"allow-clear":"",value:t.is_active,"onUpdate:value":s[3]||(s[3]=a=>t.is_active=a),class:i({"select-danger":t.errors.is_active})},null,8,["options","filter-option","value","class"]),s[18]||(s[18]=e("div",{class:"w-100"},null,-1)),r(d,{message:t.errors.is_active},null,8,["message"])])]),e("div",ls,[s[20]||(s[20]=e("div",{class:"col-12 col-sm-3 text-start text-sm-end"},null,-1)),e("div",is,[r(_,{checked:t.change_password,"onUpdate:checked":s[4]||(s[4]=a=>t.change_password=a)},{default:p(()=>s[19]||(s[19]=[z(" Đổi mật khẩu ")])),_:1},8,["checked"])])]),t.change_password==!0?(k(),b("div",ds,[e("div",ms,[e("label",null,[s[21]||(s[21]=e("span",{class:"text-danger me-1"},"*",-1)),e("span",{class:i({"text-danger":t.errors.password})}," Mật khẩu ",2)])]),e("div",ps,[r(v,{placeholder:"Mật khẩu","allow-clear":"",value:t.password,"onUpdate:value":s[5]||(s[5]=a=>t.password=a),class:i({"input-danger":t.errors.password})},null,8,["value","class"]),s[22]||(s[22]=e("div",{class:"w-100"},null,-1)),r(d,{message:t.errors.password},null,8,["message"])])])):C("",!0),t.change_password==!0?(k(),b("div",us,[e("div",cs,[e("label",null,[s[23]||(s[23]=e("span",{class:"text-danger me-1"},"*",-1)),e("span",{class:i({"text-danger":t.errors.password_confirmation})}," Xác nhận mật khẩu ",2)])]),e("div",vs,[r(v,{placeholder:"Xác nhận mật khẩu","allow-clear":"",value:t.password_confirmation,"onUpdate:value":s[6]||(s[6]=a=>t.password_confirmation=a),class:i({"input-danger":t.errors.password_confirmation})},null,8,["value","class"]),s[24]||(s[24]=e("div",{class:"w-100"},null,-1)),r(d,{message:t.errors.password_confirmation},null,8,["message"])])])):C("",!0)])]),e("div",gs,[e("div",ws,[r(o,{class:"me-0 me-sm-2 mb-2 mb-sm-0",type:"primary",danger:"",ghost:"",onClick:s[7]||(s[7]=a=>t.$router.push({name:"admin-users"}))},{default:p(()=>s[25]||(s[25]=[e("span",null,"Hủy",-1)])),_:1}),r(o,{type:"primary","html-type":"submit"},{default:p(()=>s[26]||(s[26]=[e("span",null,"Cập nhật",-1)])),_:1})])])]),_:1})],32)}const Es=S(R,[["render",hs]]);export{Es as default};
